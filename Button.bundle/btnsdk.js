var btnsdk=function(e){"use strict";function n(e){f.info("observing input from SDK");const n=d.sanitizedInput(e,a.currentFillId);if(!n)return f.info("could not sanitize input to observe, returning false"),!1;const t=a.observeFields(window,n);return t?f.info("successfully observed, returning true",a.currentFields):f.info("failed to observe fields, returning false"),t}function t(e){f.info("filling fields from SDK");const n=d.sanitizedInput(e,a.currentFillId,!0);return n?(c.fillFields(a.addElementsToFields(n),i,o),f.info("successfully filled, returning true"),!0):(f.info("could not sanitize input for fill, returning false"),!1)}function i(){window.removeEventListener("focusout",a._focusOutListener)}function o(){window.addEventListener("focusout",a._focusOutListener)}function s(e,n){if(f.info("session started with fields found: ",n),!n){const n={ios:"BTNJSAutofillFieldsNotDetected",android:"onAutofillFieldsNotDetected"},t=e;return void d.postMessage(t,n,null,"ios")}const t={url:e.location.href,title:e.document.title},i={fill_id:a.currentFillId,page_info:t,fields:a.removeElementsFromFields(a.currentFields)},o={ios:"BTNJSAutofillFieldsDetected",android:"onAutofillFieldsDetected"},s=e;d.postMessage(s,o,i,"ios")}function r(e){f.info("onDOMUpdate"),a.startNewSession(e).then(function(n){s(e,n)})}function l(e){f.info("onPageLoad"),a.startNewSession(e).then(function(n){h.startWatching(e.document,function(){a.finishSession(),r(e)}),s(e,n)})}function u(e){switch(f.info("readyState:",e.document.readyState),e.document.readyState){case"loading":f.info("Adding DOMContentLoaded listener"),e.addEventListener("DOMContentLoaded",function(){f.info("DOMContentLoaded event fired"),u(e)});break;case"interactive":d.getIframes(e.document).length>0?(f.info("iframes found, adding load listener"),e.addEventListener("load",function(){f.info("load event fired"),l(e)})):(f.info("no iframes found"),l(e));break;case"complete":l(e);break;default:f.info("unknown ready state")}}const f={environment:"production",init(e){f.environment=e},info(...e){if("development"===f.environment){const n=e.slice();n.unshift("[btnsdk]"),console.log(n)}}},d={generateUUIDv4(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===n?t:3&t|8).toString(16)})},postMessage(e,n,t,i){const o=n[i];f.info("posting message",o,t),"ios"===i?e.webkit.messageHandlers[o].postMessage(t):"android"===i&&e[o](JSON.stringify(t))},getIframes(e){return[].slice.call(e.getElementsByTagName("iframe")).filter(function(n){return d.hasSameOrigin(e,n)})},hasSameOrigin(e,n){const t=e.createElement("a");return t.href=n.src,-1===["http:","https:"].indexOf(t.protocol)||e.location.protocol===t.protocol&&e.location.hostname===t.hostname&&e.location.port===t.port},sanitizedInput(e,n,t=!1){if(f.info("util sanitizing input"),!e)return f.info("no input, returning null"),null;const i=e.fill_id;if(!i||i!==n)return f.info("bad fillId, returning null"),null;const{fields:fields}=e;if(!fields||0===fields.length)return f.info("no fields, returning null"),null;const o=[],s=fields.length;for(let e=0;e<s;e+=1){const n=fields[e];n.param&&"ignore"!==n.param&&(n.param&&n.pop_id&&(!t||n.value)&&n.input_type.match(/^(text|email|tel)$/)&&o.push({param:n.param,pop_id:n.pop_id,value:n.value}))}return 0===o.length?(f.info("no sanitized fields, returning null"),null):(f.info("input sanitized, returning fields: ",o),o)}},c={getLabelMappings(e){if(f.info("getting label mappings for doc:",e),!e)return f.info("no doc for label mappings"),null;const n=e.getElementsByTagName("label"),t=n.length,i={};for(let e=0;e<t;e+=1){const t=n[e].htmlFor;""!==t&&(i[t]=n[e].textContent)}return f.info("got label mappings:",i),i},inputElements(e){if(!e)return[];let n=[];"function"==typeof e.matches&&e.matches("input")&&n.push(e),"function"==typeof e.querySelectorAll&&(n=n.concat([].slice.call(e.querySelectorAll("input"))));const t=["text","email","tel"];return n.filter(e=>t.includes(e.type))},fieldsInDocument(e){if(f.info("getting fields in doc:",e),!e)return f.info("no doc for fields"),[];const n=c.inputElements(e),t=n.length;if(0===t)return f.info("no elements in doc, returning empty list"),[];f.info("creating fields for elements:",n);const i=[],o=c.getLabelMappings(e);for(let e=0;e<t;e+=1){const t=n[e],s={element:t,pop_id:d.generateUUIDv4(),id:t.id,name:t.name,placeholder:t.placeholder,tag_name:t.tagName,type:t.type,autocomplete:t.autocomplete,autocompletetype:t.autocompletetype,readonly:t.readonly,disabled:t.disabled};o&&(s.label=o[t.id]),i.push(s)}return f.info("got fields:",i),i},getFields(e,n){return new Promise(function(t){f.info("getting fields for session:",n);let i=c.fieldsInDocument(e);f.info("checking doc for iframes");const o=d.getIframes(e),s=o.length;f.info("iframe count:",s);for(let e=0;e<s;e+=1)i=i.concat(c.fieldsInDocument(o[e].contentDocument));f.info("resolving with info"),t({fillId:n,fields:i})})},fillFields(e,n,t){n();const i=e.length;for(let n=0;n<i;n+=1){const{element:element,value:value}=e[n];element&&value&&(element.focus(),element.value=value)}e[0].element.focus(),t()}},a={currentFillId:void 0,currentFields:void 0,submittedFillId:void 0,submittedFields:void 0,_focusOutListener(e){f.info("focus out",e.target.value);const n=a.currentFields.length;for(let t=0;t<n;t+=1){const n=a.currentFields[t];if(f.info("comparing",n.element,e.target),n.element===e.target){if(f.info("focusout value",e.target.value),!e.target.value||0===e.target.value.length)return;const{pop_id:pop_id,param:param}=n,t={pop_id:pop_id,param:param,value:e.target.value},i={fill_id:a.currentFillId,fields:[t]},o={ios:"BTNJSAutofillFormSubmitted",android:"onAutofillFormSubmitted"},s=window;d.postMessage(s,o,i,"ios")}}},startNewSession(e){return new Promise(function(n){a.currentFillId=d.generateUUIDv4(),f.info("starting new session",a.currentFillId),a.currentFields=[],e.removeEventListener("focusout",a._focusOutListener),c.getFields(e.document,a.currentFillId).then(function(e){e&&e.fields&&e.fillId===a.currentFillId&&0!==e.fields.length?(a.currentFields=e.fields,f.info("fields set on session start, returning true",a.currentFields),n(!0)):(f.info("invalid getFields on session start, returning false"),n(!1))})})},removeElementsFromFields(e){f.info("removing elements from fields");const n=[],t=e.length;for(let i=0;i<t;i+=1){const t=Object.assign({},e[i]);delete t.element,n.push(t)}return n},addElementsToFields(e){f.info("adding elements to fields");const n=[],t=e.length;for(let i=0;i<t;i+=1){const t=Object.assign({},e[i]),o=a.currentFields.filter(function(e){return e.pop_id===t.pop_id})[0];o&&(t.element=o.element),n.push(t)}return n},observeFields(e,n){f.info("session observe fields start",n,a.currentFields);const t=[],i=n.length,o=a.currentFields.length;for(let e=0;e<i;e+=1){const i=n[e];for(let s=0;s<o;s+=1){const o=a.currentFields[s];i.pop_id===o.pop_id?(f.info("found a match for field with param: ",i.param),t.push(Object.assign(i,o))):f.info("no match for field to observe with param: ",n[e].param)}}return f.info("new session fields set on observation",t),a.currentFields=t,0===t.length?(f.info("no matching fields to observe"),!1):(f.info("existing matching fields to observe, adding input listener"),e.addEventListener("focusout",a._focusOutListener),!0)},finishSession(){if(f.info("finishing session"),!a.currentFillId)return void f.info("no current session on session finish");if(!a.currentFields||0===a.currentFields.length)return void f.info("no observed fields on session finish");a.submittedFillId=a.currentFillId,a.submittedFields=a.currentFields.slice(),f.info("moving fields from current to submitted",a.submittedFields);const e=[],n=a.submittedFields.length;for(let t=0;t<n;t+=1){const n=a.submittedFields[t],{pop_id:pop_id,param:param,inputValue:inputValue}=n;pop_id&&param&&inputValue?(e.push({pop_id:pop_id,param:param,value:inputValue}),f.info("adding filled field for session callback",e[e.length-1])):(pop_id||f.info("omitting field, no pop_id",n),param||f.info("omitting field, no param",n),inputValue||f.info("omitting field, no input value",n))}const t={fill_id:a.submittedFillId,fields:e};if(!t||!t.fields||0===t.fields.length)return void f.info("invalid payload on session finish");const i={ios:"BTNJSAutofillFormSubmitted",android:"onAutofillFormSubmitted"},o=window;d.postMessage(o,i,t,"ios")}},m=(e,n)=>{function t(){e.call(null,...s),o=null,i=(new Date).getTime()}let i=0;let o=null;let s=null;return function(...r){const l=(new Date).getTime();l-i>n?(e.call(null,...r),i=l):(s=r,o||(o=window.setTimeout(t,n)))}};class g{constructor(e,n=m){this.observer=e,this.throttle=n,this.mutations=[]}startWatching(e,n){const t=this.throttle(this.checkMutations,250),i=this;this.observer.observe(e,function(e){i.mutations=i.mutations.concat(e),t(i,n)})}checkMutations(e,n){const t=e.mutations.some(function(e){return"childList"===e.type&&Array.prototype.slice.call(e.addedNodes).some(function(e){return c.inputElements(e).length>0})});e.mutations=[],t&&n()}}class p{observe(e,n){this.mutationObserver&&this.stop(),this.mutationObserver=new MutationObserver(n),this.mutationObserver.observe(e,{childList:!0,subtree:!0,attributes:!1,characterData:!1})}stop(){this.mutationObserver.disconnect()}}f.init("production"),f.info("bridge injected");const h=new g(new p);return f.info("adding submit listener"),window.addEventListener("submit",()=>{a.finishSession()}),f.info("checking readyState"),u(window),e.observeFields=n,e.fillFields=t,e}({});
