var btnsdk=function(e){"use strict";function n(e){l.info("observing input from SDK");const n=u.sanitizedInput(e,d.currentFillId);if(!n)return l.info("could not sanitize input to observe, returning false"),!1;const t=d.observeFields(window,n);return t?l.info("successfully observed, returning true",d.currentFields):l.info("failed to observe fields, returning false"),t}function t(e){l.info("filling fields from SDK");const n=u.sanitizedInput(e,d.currentFillId,!0);return n?(f.fillFields(d.addElementsToFields(n)),l.info("successfully filled, returning true"),!0):(l.info("could not sanitize input for fill, returning false"),!1)}function i(e,n){if(l.info("session started with fields found: ",n),!n){const n={ios:"BTNJSAutofillFieldsNotDetected",android:"onAutofillFieldsNotDetected"},t=e;return void u.postMessage(t,n,null,"ios")}const t={url:e.location.href,title:e.document.title},i={fill_id:d.currentFillId,page_info:t,fields:d.removeElementsFromFields(d.currentFields)},o={ios:"BTNJSAutofillFieldsDetected",android:"onAutofillFieldsDetected"},s=e;u.postMessage(s,o,i,"ios")}function o(e){l.info("onDOMUpdate"),d.startNewSession(e).then(function(n){i(e,n)})}function s(e){l.info("onPageLoad"),d.startNewSession(e).then(function(n){g.startWatching(e.document,function(){d.finishSession(),o(e)}),i(e,n)})}function r(e){switch(l.info("readyState:",e.document.readyState),e.document.readyState){case"loading":l.info("Adding DOMContentLoaded listener"),e.addEventListener("DOMContentLoaded",function(){l.info("DOMContentLoaded event fired"),r(e)});break;case"interactive":u.getIframes(e.document).length>0?(l.info("iframes found, adding load listener"),e.addEventListener("load",function(){l.info("load event fired"),s(e)})):(l.info("no iframes found"),s(e));break;case"complete":s(e);break;default:l.info("unknown ready state")}}const l={environment:"production",init(e){l.environment=e},info(...e){if("development"===l.environment){const n=e.slice();n.unshift("[btnsdk]"),console.log(n)}}},u={generateUUIDv4(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===n?t:3&t|8).toString(16)})},postMessage(e,n,t,i){const o=n[i];l.info("posting message",o,t),"ios"===i?e.webkit.messageHandlers[o].postMessage(t):"android"===i&&e[o](JSON.stringify(t))},getIframes(e){return[].slice.call(e.getElementsByTagName("iframe")).filter(function(n){return u.hasSameOrigin(e,n)})},hasSameOrigin(e,n){const t=e.createElement("a");if(t.href=n.src,-1===["http:","https:"].indexOf(t.protocol))return!0;const i=e.location;return i.protocol===t.protocol&&i.hostname===t.hostname&&i.port===t.port},sanitizedInput(e,n,t=!1){if(l.info("util sanitizing input"),!e)return l.info("no input, returning null"),null;const i=e.fill_id;if(!i||i!==n)return l.info("bad fillId, returning null"),null;const{fields:fields}=e;if(!fields||0===fields.length)return l.info("no fields, returning null"),null;const o=[],s=fields.length;for(let e=0;e<s;e+=1){const n=fields[e];n.param&&"ignore"!==n.param&&(n.param&&n.pop_id&&(!t||n.value)&&n.input_type.match(/^(text|email|tel)$/)&&o.push({param:n.param,pop_id:n.pop_id,value:n.value}))}return 0===o.length?(l.info("no sanitized fields, returning null"),null):(l.info("input sanitized, returning fields: ",o),o)}},f={getLabelMappings(e){if(l.info("getting label mappings for doc:",e),!e)return l.info("no doc for label mappings"),null;const n=e.getElementsByTagName("label"),t=n.length,i={};for(let e=0;e<t;e+=1){const t=n[e].htmlFor;""!==t&&(i[t]=n[e].textContent)}return l.info("got label mappings:",i),i},inputElements(e){if(!e)return[];let n=[];const t="input[type=text],input[type=email],input[type=tel]";return"function"==typeof e.matches&&e.matches(t)&&n.push(e),"function"==typeof e.querySelectorAll&&(n=n.concat([].slice.call(e.querySelectorAll(t)))),n},fieldsInDocument(e){if(l.info("getting fields in doc:",e),!e)return l.info("no doc for fields"),[];const n=f.inputElements(e),t=n.length;if(0===t)return l.info("no elements in doc, returning empty list"),[];l.info("creating fields for elements:",n);const i=[],o=f.getLabelMappings(e);for(let e=0;e<t;e+=1){const t=n[e],s={element:t,pop_id:u.generateUUIDv4(),id:t.id,name:t.name,placeholder:t.placeholder,tag_name:t.tagName,type:t.type,autocomplete:t.autocomplete,autocompletetype:t.autocompletetype,readonly:t.readonly,disabled:t.disabled};o&&(s.label=o[t.id]),i.push(s)}return l.info("got fields:",i),i},getFields(e,n){return new Promise(function(t){l.info("getting fields for session:",n);let i=f.fieldsInDocument(e);l.info("checking doc for iframes");const o=u.getIframes(e),s=o.length;l.info("iframe count:",s);for(let e=0;e<s;e+=1)i=i.concat(f.fieldsInDocument(o[e].contentDocument));l.info("resolving with info"),t({fillId:n,fields:i})})},fillFields(e){const n=e.length;for(let t=0;t<n;t+=1){const{element:element,value:value}=e[t];element&&value&&(element.value=value)}}},d={currentFillId:void 0,currentFields:void 0,submittedFillId:void 0,submittedFields:void 0,_focusOutListener(e){l.info("focus out",e.target.value);const n=d.currentFields.length;for(let t=0;t<n;t+=1){const n=d.currentFields[t];if(l.info("comparing",n.element,e.target),n.element===e.target){if(l.info("focusout value",e.target.value),!e.target.value||0===e.target.value.length)return;const{pop_id:pop_id,param:param}=n,t={pop_id:pop_id,param:param,value:e.target.value},i={fill_id:d.currentFillId,fields:[t]},o={ios:"BTNJSAutofillFormSubmitted",android:"onAutofillFormSubmitted"},s=window;u.postMessage(s,o,i,"ios")}}},startNewSession(e){return new Promise(function(n){d.currentFillId=u.generateUUIDv4(),l.info("starting new session",d.currentFillId),d.currentFields=[],e.removeEventListener("focusout",d._focusOutListener),f.getFields(e.document,d.currentFillId).then(function(e){e&&e.fields&&e.fillId===d.currentFillId&&0!==e.fields.length?(d.currentFields=e.fields,l.info("fields set on session start, returning true",d.currentFields),n(!0)):(l.info("invalid getFields on session start, returning false"),n(!1))})})},removeElementsFromFields(e){l.info("removing elements from fields");const n=[],t=e.length;for(let i=0;i<t;i+=1){const t=Object.assign({},e[i]);delete t.element,n.push(t)}return n},addElementsToFields(e){l.info("adding elements to fields");const n=[],t=e.length;for(let i=0;i<t;i+=1){const t=Object.assign({},e[i]),o=d.currentFields.filter(function(e){return e.pop_id===t.pop_id})[0];o&&(t.element=o.element),n.push(t)}return n},observeFields(e,n){l.info("session observe fields start",n,d.currentFields);const t=[],i=n.length,o=d.currentFields.length;for(let e=0;e<i;e+=1){const i=n[e];for(let s=0;s<o;s+=1){const o=d.currentFields[s];i.pop_id===o.pop_id?(l.info("found a match for field with param: ",i.param),t.push(Object.assign(i,o))):l.info("no match for field to observe with param: ",n[e].param)}}return l.info("new session fields set on observation",t),d.currentFields=t,0===t.length?(l.info("no matching fields to observe"),!1):(l.info("existing matching fields to observe, adding input listener"),e.addEventListener("focusout",d._focusOutListener),!0)},finishSession(){if(l.info("finishing session"),!d.currentFillId)return void l.info("no current session on session finish");if(!d.currentFields||0===d.currentFields.length)return void l.info("no observed fields on session finish");d.submittedFillId=d.currentFillId,d.submittedFields=d.currentFields.slice(),l.info("moving fields from current to submitted",d.submittedFields);const e=[],n=d.submittedFields.length;for(let t=0;t<n;t+=1){const n=d.submittedFields[t],{pop_id:pop_id,param:param,inputValue:inputValue}=n;pop_id&&param&&inputValue?(e.push({pop_id:pop_id,param:param,value:inputValue}),l.info("adding filled field for session callback",e[e.length-1])):(pop_id||l.info("omitting field, no pop_id",n),param||l.info("omitting field, no param",n),inputValue||l.info("omitting field, no input value",n))}const t={fill_id:d.submittedFillId,fields:e};if(!t||!t.fields||0===t.fields.length)return void l.info("invalid payload on session finish");const i={ios:"BTNJSAutofillFormSubmitted",android:"onAutofillFormSubmitted"},o=window;u.postMessage(o,i,t,"ios")}},a=(e,n)=>{function t(){e.call(null,...s),o=null,i=(new Date).getTime()}let i=0;let o=null;let s=null;return function(...r){const l=(new Date).getTime();l-i>n?(e.call(null,...r),i=l):(s=r,o||(o=window.setTimeout(t,n)))}};class c{constructor(e,n=a){this.observer=e,this.throttle=n,this.mutations=[]}startWatching(e,n){const t=this.throttle(this.checkMutations,250),i=this;this.observer.observe(e,function(e){i.mutations=i.mutations.concat(e),t(i,n)})}checkMutations(e,n){const t=e.mutations.some(function(e){return"childList"===e.type&&Array.prototype.slice.call(e.addedNodes).some(function(e){return f.inputElements(e).length>0})});e.mutations=[],t&&n()}}class m{observe(e,n){this.mutationObserver&&this.stop(),this.mutationObserver=new MutationObserver(n),this.mutationObserver.observe(e,{childList:!0,subtree:!0,attributes:!1,characterData:!1})}stop(){this.mutationObserver.disconnect()}}l.init("production"),l.info("bridge injected");const g=new c(new m);return l.info("adding submit listener"),window.addEventListener("submit",()=>{d.finishSession()}),l.info("checking readyState"),r(window),e.observeFields=n,e.fillFields=t,e}({});
