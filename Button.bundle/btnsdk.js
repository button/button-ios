var btnsdk=function(t){"use strict";function e(t){const e=a.sanitizedInput(t,f.currentFillId);return!!e&&f.observeFields(window,e)}function n(t){const e=a.sanitizedInput(t,f.currentFillId,!0);return!!e&&(d.fillFields(f.addElementsToFields(e),i,o),!0)}function i(){window.removeEventListener("focusout",f._focusOutListener)}function o(){window.addEventListener("focusout",f._focusOutListener)}function r(t,e){if(!e){const e={ios:"BTNJSAutofillFieldsNotDetected",android:"onAutofillFieldsNotDetected"},n=t;return void a.postMessage(n,e,null,"ios")}const n={url:t.location.href,title:t.document.title},i={fill_id:f.currentFillId,page_info:n,fields:f.removeElementsFromFields(f.currentFields)},o={ios:"BTNJSAutofillFieldsDetected",android:"onAutofillFieldsDetected"},r=t;a.postMessage(r,o,i,"ios")}function l(t){f.startNewSession(t).then(function(e){r(t,e)})}function s(t){f.startNewSession(t).then(function(e){g.startWatching(t.document,function(){f.finishSession(),l(t)}),r(t,e)})}function u(t){switch(c.info("readyState:",t.document.readyState),t.document.readyState){case"loading":t.addEventListener("DOMContentLoaded",function(){u(t)});break;case"interactive":a.getIframes(t.document).length>0?t.addEventListener("load",function(){s(t)}):s(t);break;case"complete":s(t)}}const c={info(...t){}},a={generateUUIDv4(){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)})},postMessage(t,e,n,i){const o=e[i];"ios"===i?t.webkit.messageHandlers[o].postMessage(n):"android"===i&&t[o](JSON.stringify(n))},getIframes(t){return[].slice.call(t.getElementsByTagName("iframe")).filter(function(e){return a.hasSameOrigin(t,e)})},hasSameOrigin(t,e){const n=t.createElement("a");return n.href=e.src,-1===["http:","https:"].indexOf(n.protocol)||t.location.protocol===n.protocol&&t.location.hostname===n.hostname&&t.location.port===n.port},sanitizedInput(t,e,n=!1){if(!t)return null;const i=t.fill_id;if(!i||i!==e)return null;const{fields:fields}=t;if(!fields||0===fields.length)return null;const o=[],r=fields.length;for(let t=0;t<r;t+=1){const e=fields[t];e.param&&"ignore"!==e.param&&(e.param&&e.pop_id&&(!n||e.value)&&e.input_type.match(/^(text|email|tel)$/)&&o.push({param:e.param,pop_id:e.pop_id,value:e.value}))}return 0===o.length?null:o}},d={getLabelMappings(t){if(!t)return null;const e=t.getElementsByTagName("label"),n=e.length,i={};for(let t=0;t<n;t+=1){const n=e[t].htmlFor;""!==n&&(i[n]=e[t].textContent)}return i},inputElements(t){if(!t)return[];let e=[];"function"==typeof t.matches&&t.matches("input")&&e.push(t),"function"==typeof t.querySelectorAll&&(e=e.concat([].slice.call(t.querySelectorAll("input"))));const n=["text","email","tel"];return e.filter(t=>n.includes(t.type))},fieldsInDocument(t){if(!t)return[];const e=d.inputElements(t),n=e.length;if(0===n)return[];const i=[],o=d.getLabelMappings(t);for(let t=0;t<n;t+=1){const n=e[t],r={element:n,pop_id:a.generateUUIDv4(),id:n.id,name:n.name,placeholder:n.placeholder,tag_name:n.tagName,type:n.type,autocomplete:n.autocomplete,autocompletetype:n.autocompletetype,readonly:n.readonly,disabled:n.disabled};o&&(r.label=o[n.id]),i.push(r)}return i},getFields(t,e){return new Promise(function(n){let i=d.fieldsInDocument(t);const o=a.getIframes(t),r=o.length;for(let t=0;t<r;t+=1)i=i.concat(d.fieldsInDocument(o[t].contentDocument));n({fillId:e,fields:i})})},fillFields(t,e,n){e();const i=t.length;for(let e=0;e<i;e+=1){const{element:element,value:value}=t[e];element&&value&&(element.focus(),element.value=value)}t[0].element.focus(),n()}},f={currentFillId:void 0,currentFields:void 0,submittedFillId:void 0,submittedFields:void 0,_focusOutListener(t){c.info("focus out",t.target.value);const e=f.currentFields.length;for(let n=0;n<e;n+=1){const e=f.currentFields[n];if(c.info("comparing",e.element,t.target),e.element===t.target){if(c.info("focusout value",t.target.value),!t.target.value||0===t.target.value.length)return;const{pop_id:pop_id,param:param}=e,n={pop_id:pop_id,param:param,value:t.target.value},i={fill_id:f.currentFillId,fields:[n]},o={ios:"BTNJSAutofillFormSubmitted",android:"onAutofillFormSubmitted"},r=window;a.postMessage(r,o,i,"ios")}}},startNewSession(t){return new Promise(function(e){f.currentFillId=a.generateUUIDv4(),f.currentFields=[],t.removeEventListener("focusout",f._focusOutListener),d.getFields(t.document,f.currentFillId).then(function(t){t&&t.fields&&t.fillId===f.currentFillId&&0!==t.fields.length?(f.currentFields=t.fields,e(!0)):e(!1)})})},removeElementsFromFields(t){const e=[],n=t.length;for(let i=0;i<n;i+=1){const n=Object.assign({},t[i]);delete n.element,e.push(n)}return e},addElementsToFields(t){const e=[],n=t.length;for(let i=0;i<n;i+=1){const n=Object.assign({},t[i]),o=f.currentFields.filter(function(t){return t.pop_id===n.pop_id})[0];o&&(n.element=o.element),e.push(n)}return e},observeFields(t,e){const n=[],i=e.length,o=f.currentFields.length;for(let t=0;t<i;t+=1){const i=e[t];for(let r=0;r<o;r+=1){const o=f.currentFields[r];i.pop_id===o.pop_id?(c.info("found a match for field with param: ",i.param),n.push(Object.assign(i,o))):c.info("no match for field to observe with param: ",e[t].param)}}return f.currentFields=n,0!==n.length&&(t.addEventListener("focusout",f._focusOutListener),!0)},finishSession(){if(f.currentFillId&&f.currentFields&&0!==f.currentFields.length){f.submittedFillId=f.currentFillId,f.submittedFields=f.currentFields.slice();const t=[],e=f.submittedFields.length;for(let n=0;n<e;n+=1){const e=f.submittedFields[n],{pop_id:pop_id,param:param,inputValue:inputValue}=e;pop_id&&param&&inputValue&&t.push({pop_id:pop_id,param:param,value:inputValue})}const n={fill_id:f.submittedFillId,fields:t};if(n&&n.fields&&0!==n.fields.length){const t={ios:"BTNJSAutofillFormSubmitted",android:"onAutofillFormSubmitted"},e=window;a.postMessage(e,t,n,"ios")}}}},m=(t,e)=>{function n(){t.call(null,...r),o=null,i=(new Date).getTime()}let i=0;let o=null;let r=null;return function(...l){const s=(new Date).getTime();s-i>e?(t.call(null,...l),i=s):(r=l,o||(o=window.setTimeout(n,e)))}};class p{constructor(t,e=m){this.observer=t,this.throttle=e,this.mutations=[]}startWatching(t,e){const n=this.throttle(this.checkMutations,250),i=this;this.observer.observe(t,function(t){i.mutations=i.mutations.concat(t),n(i,e)})}checkMutations(t,e){const n=t.mutations.some(function(t){return"childList"===t.type&&Array.prototype.slice.call(t.addedNodes).some(function(t){return d.inputElements(t).length>0})});t.mutations=[],n&&e()}}class h{observe(t,e){this.mutationObserver&&this.stop(),this.mutationObserver=new MutationObserver(e),this.mutationObserver.observe(t,{childList:!0,subtree:!0,attributes:!1,characterData:!1})}stop(){this.mutationObserver.disconnect()}}const g=new p(new h);return window.addEventListener("submit",()=>{f.finishSession()}),u(window),t.observeFields=e,t.fillFields=n,t}({});
